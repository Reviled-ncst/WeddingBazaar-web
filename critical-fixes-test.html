<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Bazaar - Critical Fixes Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #2d3748;
            margin-bottom: 40px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: #f8fafc;
        }
        .test-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
        }
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }
        .status.success { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #742a2a; }
        .status.warning { background: #feebc8; color: #7b341e; }
        .status.loading { background: #bee3f8; color: #2a4365; }
        .test-details {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
        }
        .api-data {
            background: #f7fafc;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9em;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .vendor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .vendor-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .vendor-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .vendor-category {
            color: #667eea;
            font-weight: 600;
            background: #edf2f7;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
        }
        .vendor-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        .stars {
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Wedding Bazaar - Critical Fixes Verification</h1>
            <p>Testing the priority issues identified in the coding instructions</p>
        </div>

        <!-- Priority 1: Featured Vendors API Format -->
        <div class="test-section">
            <div class="test-title">üî• Priority 1: Featured Vendors API Format</div>
            <div id="vendor-status" class="status loading">Testing...</div>
            <div class="test-details">
                <p><strong>Issue:</strong> Frontend expects {business_name, business_type, rating: string} but backend returns {name, category, rating: number}</p>
                <p><strong>Expected:</strong> Component should handle new format correctly</p>
                <div id="vendor-results"></div>
                <div id="vendor-display" class="vendor-grid"></div>
            </div>
        </div>

        <!-- Priority 2: Auth Context Response Format -->
        <div class="test-section">
            <div class="test-title">üîê Priority 2: Auth Context Response Format</div>
            <div id="auth-status" class="status loading">Testing...</div>
            <div class="test-details">
                <p><strong>Issue:</strong> Console shows "‚ùå Invalid verify response"</p>
                <p><strong>Expected:</strong> Backend should return {success, authenticated, user} format</p>
                <div id="auth-results"></div>
            </div>
        </div>

        <!-- Priority 3: Navigation Buttons -->
        <div class="test-section">
            <div class="test-title">üß≠ Priority 3: Navigation Functionality</div>
            <div id="nav-status" class="status loading">Testing...</div>
            <div class="test-details">
                <p><strong>Issue:</strong> "View All Vendors" button should navigate properly</p>
                <p><strong>Expected:</strong> Navigation handlers should be implemented</p>
                <div id="nav-results"></div>
                <button onclick="testNavigation()">Test Navigation</button>
            </div>
        </div>

        <!-- Backend Endpoint Health -->
        <div class="test-section">
            <div class="test-title">üåê Backend Endpoint Health</div>
            <div id="health-status" class="status loading">Testing...</div>
            <div class="test-details">
                <p><strong>Checking:</strong> All production API endpoints</p>
                <div id="health-results"></div>
            </div>
        </div>

        <!-- Overall Status -->
        <div class="test-section">
            <div class="test-title">üìä Overall Fix Status</div>
            <div id="overall-status" class="status loading">Evaluating...</div>
            <div class="test-details">
                <div id="overall-results"></div>
                <button onclick="runAllTests()">Re-run All Tests</button>
                <button onclick="window.open('http://localhost:5175', '_blank')">Open Live App</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://weddingbazaar-web.onrender.com';
        
        function addLog(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const logEntry = document.createElement('div');
            logEntry.className = 'api-data';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(logEntry);
        }

        async function testFeaturedVendors() {
            const statusEl = document.getElementById('vendor-status');
            const resultsEl = document.getElementById('vendor-results');
            const displayEl = document.getElementById('vendor-display');
            
            try {
                statusEl.textContent = 'Testing Featured Vendors API...';
                statusEl.className = 'status loading';
                
                addLog('vendor-results', 'üîç Testing /api/vendors/featured endpoint...');
                
                const response = await fetch(`${API_BASE}/api/vendors/featured`);
                const data = await response.json();
                
                addLog('vendor-results', `üìä Response Status: ${response.status}`);
                addLog('vendor-results', `üìä Response Format: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success && data.vendors && Array.isArray(data.vendors)) {
                    const vendors = data.vendors;
                    addLog('vendor-results', `‚úÖ Found ${vendors.length} vendors`);
                    
                    // Check the format
                    const sampleVendor = vendors[0];
                    const hasNewFormat = sampleVendor.name && sampleVendor.category;
                    const hasOldFormat = sampleVendor.business_name && sampleVendor.business_type;
                    
                    if (hasNewFormat) {
                        addLog('vendor-results', '‚úÖ New format detected: {name, category, rating: number}');
                        statusEl.textContent = '‚úÖ API Format - FIXED';
                        statusEl.className = 'status success';
                    } else if (hasOldFormat) {
                        addLog('vendor-results', '‚ö†Ô∏è Old format detected: {business_name, business_type}');
                        statusEl.textContent = '‚ö†Ô∏è API Format - NEEDS FRONTEND UPDATE';
                        statusEl.className = 'status warning';
                    }
                    
                    // Display vendors
                    displayEl.innerHTML = '';
                    vendors.slice(0, 3).forEach(vendor => {
                        const card = document.createElement('div');
                        card.className = 'vendor-card';
                        card.innerHTML = `
                            <div class="vendor-name">${vendor.name || vendor.business_name || 'Unknown Vendor'}</div>
                            <div class="vendor-category">${vendor.category || vendor.business_type || 'General'}</div>
                            <div class="vendor-rating">
                                <span class="stars">${'‚òÖ'.repeat(Math.floor(vendor.rating || 4.5))}</span>
                                <span>${vendor.rating || 4.5}/5.0</span>
                                <span>(${vendor.reviewCount || vendor.review_count || 0} reviews)</span>
                            </div>
                            <p>${vendor.description || 'Professional wedding services'}</p>
                        `;
                        displayEl.appendChild(card);
                    });
                    
                } else {
                    addLog('vendor-results', '‚ùå Invalid response format or no vendors found');
                    statusEl.textContent = '‚ùå API Format - FAILED';
                    statusEl.className = 'status error';
                }
                
            } catch (error) {
                addLog('vendor-results', `‚ùå Error: ${error.message}`);
                statusEl.textContent = '‚ùå API Format - ERROR';
                statusEl.className = 'status error';
            }
        }

        async function testAuthVerification() {
            const statusEl = document.getElementById('auth-status');
            const resultsEl = document.getElementById('auth-results');
            
            try {
                statusEl.textContent = 'Testing Auth Verification...';
                statusEl.className = 'status loading';
                
                addLog('auth-results', 'üîç Testing /api/auth/verify endpoint with invalid token...');
                
                const response = await fetch(`${API_BASE}/api/auth/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer fake_token_for_testing'
                    }
                });
                
                const data = await response.json();
                
                addLog('auth-results', `üìä Response Status: ${response.status}`);
                addLog('auth-results', `üìä Response Format: ${JSON.stringify(data, null, 2)}`);
                
                // Check if response has the expected format
                if (typeof data.success === 'boolean' && 
                    typeof data.authenticated === 'boolean') {
                    addLog('auth-results', '‚úÖ Correct response format detected');
                    statusEl.textContent = '‚úÖ Auth Format - CORRECT';
                    statusEl.className = 'status success';
                } else {
                    addLog('auth-results', '‚ùå Response format does not match expected {success, authenticated, user}');
                    statusEl.textContent = '‚ùå Auth Format - INCORRECT';
                    statusEl.className = 'status error';
                }
                
            } catch (error) {
                addLog('auth-results', `‚ùå Error: ${error.message}`);
                statusEl.textContent = '‚ùå Auth Format - ERROR';
                statusEl.className = 'status error';
            }
        }

        function testNavigation() {
            const statusEl = document.getElementById('nav-status');
            const resultsEl = document.getElementById('nav-results');
            
            addLog('nav-results', 'üîç Testing navigation functionality...');
            
            // Test if the app has proper routing
            const hasReactRouter = typeof window.history !== 'undefined' && window.history.pushState;
            
            if (hasReactRouter) {
                addLog('nav-results', '‚úÖ Browser navigation API available');
                
                // Test navigation to different routes
                const testRoutes = [
                    '/individual/services',
                    '/vendor',
                    '/admin'
                ];
                
                addLog('nav-results', `üìä Test routes available: ${testRoutes.join(', ')}`);
                statusEl.textContent = '‚úÖ Navigation - READY';
                statusEl.className = 'status success';
            } else {
                addLog('nav-results', '‚ùå Navigation API not available');
                statusEl.textContent = '‚ùå Navigation - ERROR';
                statusEl.className = 'status error';
            }
        }

        async function testBackendHealth() {
            const statusEl = document.getElementById('health-status');
            const resultsEl = document.getElementById('health-results');
            
            const endpoints = [
                '/api/health',
                '/api/ping',
                '/api/vendors/featured',
                '/api/vendors',
                '/api/auth/verify'
            ];
            
            statusEl.textContent = 'Testing Backend Health...';
            statusEl.className = 'status loading';
            
            let successCount = 0;
            
            for (const endpoint of endpoints) {
                try {
                    addLog('health-results', `üîç Testing ${endpoint}...`);
                    
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE}${endpoint}`, {
                        method: endpoint.includes('verify') ? 'POST' : 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            ...(endpoint.includes('verify') && { 'Authorization': 'Bearer test' })
                        }
                    });
                    const endTime = Date.now();
                    
                    const responseTime = endTime - startTime;
                    
                    if (response.ok || response.status === 401) { // 401 is expected for auth verify
                        addLog('health-results', `‚úÖ ${endpoint} - ${response.status} (${responseTime}ms)`);
                        successCount++;
                    } else {
                        addLog('health-results', `‚ùå ${endpoint} - ${response.status} ${response.statusText}`);
                    }
                    
                } catch (error) {
                    addLog('health-results', `‚ùå ${endpoint} - Error: ${error.message}`);
                }
            }
            
            if (successCount === endpoints.length) {
                statusEl.textContent = '‚úÖ All Endpoints - HEALTHY';
                statusEl.className = 'status success';
            } else if (successCount > endpoints.length / 2) {
                statusEl.textContent = `‚ö†Ô∏è ${successCount}/${endpoints.length} Endpoints - PARTIAL`;
                statusEl.className = 'status warning';
            } else {
                statusEl.textContent = '‚ùå Backend - UNHEALTHY';
                statusEl.className = 'status error';
            }
        }

        async function evaluateOverallStatus() {
            const overallStatusEl = document.getElementById('overall-status');
            const overallResultsEl = document.getElementById('overall-results');
            
            // Wait a bit for other tests to complete
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const vendorStatus = document.getElementById('vendor-status').className;
            const authStatus = document.getElementById('auth-status').className;
            const navStatus = document.getElementById('nav-status').className;
            const healthStatus = document.getElementById('health-status').className;
            
            const successCount = [vendorStatus, authStatus, navStatus, healthStatus]
                .filter(status => status.includes('success')).length;
            
            let overallMessage = '';
            let overallClass = '';
            
            if (successCount === 4) {
                overallMessage = 'üéâ All Critical Fixes - COMPLETE';
                overallClass = 'status success';
                overallResultsEl.innerHTML = `
                    <h3>‚úÖ Wedding Bazaar is Ready for Production!</h3>
                    <p>All priority issues have been resolved:</p>
                    <ul>
                        <li>‚úÖ Featured Vendors API format is correct</li>
                        <li>‚úÖ Auth verification response format is correct</li>
                        <li>‚úÖ Navigation functionality is working</li>
                        <li>‚úÖ Backend endpoints are healthy</li>
                    </ul>
                    <p><strong>Next Steps:</strong> Deploy frontend and test end-to-end user flows</p>
                `;
            } else if (successCount >= 2) {
                overallMessage = `‚ö†Ô∏è ${successCount}/4 Critical Fixes - PARTIAL`;
                overallClass = 'status warning';
                overallResultsEl.innerHTML = `
                    <h3>‚ö†Ô∏è Some Issues Remain</h3>
                    <p>Progress: ${successCount} out of 4 critical issues resolved</p>
                    <p><strong>Action Required:</strong> Review failing tests above and apply fixes</p>
                `;
            } else {
                overallMessage = '‚ùå Critical Issues - NEED ATTENTION';
                overallClass = 'status error';
                overallResultsEl.innerHTML = `
                    <h3>‚ùå Critical Issues Need Immediate Attention</h3>
                    <p>Only ${successCount} out of 4 critical issues are resolved</p>
                    <p><strong>Priority:</strong> Focus on failing tests above before proceeding</p>
                `;
            }
            
            overallStatusEl.textContent = overallMessage;
            overallStatusEl.className = overallClass;
        }

        async function runAllTests() {
            // Clear previous results
            ['vendor-results', 'auth-results', 'nav-results', 'health-results', 'overall-results'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            // Run all tests
            await Promise.all([
                testFeaturedVendors(),
                testAuthVerification(),
                testBackendHealth()
            ]);
            
            testNavigation();
            await evaluateOverallStatus();
        }

        // Run tests on page load
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html>
