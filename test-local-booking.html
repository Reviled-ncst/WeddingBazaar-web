<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Local Booking Creation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .button { background: #4f46e5; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        .button:hover { background: #3730a3; }
        .output { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Test Local Booking Creation & Display</h1>
    
    <button class="button" onclick="createTestBooking()">Create Test Local Booking</button>
    <button class="button" onclick="checkBookings()">Check Local Bookings</button>
    <button class="button" onclick="clearBookings()">Clear All Bookings</button>
    
    <div id="output" class="output"></div>
    
    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `[${timestamp}] ${message}\n`;
            console.log(message);
        }
        
        function createTestBooking() {
            log('Creating test local booking...');
            
            const booking = {
                id: `local_${Date.now()}`,
                service_name: 'Wedding Photography',
                service_type: 'photography',
                vendor_name: 'Perfect Photos Studio',
                contact_person: 'Maria Santos',
                contact_phone: '09123456789',
                contact_email: 'maria@example.com',
                event_date: '2024-12-25',
                event_location: 'Makati Shangri-La Hotel',
                budget_range: '‚Ç±50,000-‚Ç±100,000',
                special_requests: 'Pre-wedding photos included',
                status: 'pending',
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
                localBooking: true,
                metadata: {
                    localCreationReason: 'Backend API unavailable during booking creation',
                    needsBackendSync: true
                }
            };
            
            // Get existing bookings
            const existingBookings = JSON.parse(localStorage.getItem('weddingbazaar_local_bookings') || '[]');
            
            // Add new booking
            existingBookings.push(booking);
            
            // Save to localStorage
            localStorage.setItem('weddingbazaar_local_bookings', JSON.stringify(existingBookings));
            
            log(`‚úÖ Created local booking with ID: ${booking.id}`);
            log(`üìä Total local bookings: ${existingBookings.length}`);
            
            // Dispatch event to notify IndividualBookings component
            const event = new CustomEvent('bookingCreated', {
                detail: { booking, source: 'local' }
            });
            window.dispatchEvent(event);
            
            log('üì¢ Dispatched bookingCreated event');
        }
        
        function checkBookings() {
            log('Checking local bookings...');
            
            const localBookingsData = localStorage.getItem('weddingbazaar_local_bookings');
            
            if (localBookingsData) {
                const bookings = JSON.parse(localBookingsData);
                log(`üìä Found ${bookings.length} local booking(s):`);
                
                bookings.forEach((booking, index) => {
                    log(`\n[${index + 1}] Booking ID: ${booking.id}`);
                    log(`    Service: ${booking.service_name}`);
                    log(`    Vendor: ${booking.vendor_name}`);
                    log(`    Location: ${booking.event_location}`);
                    log(`    Budget: ${booking.budget_range}`);
                    log(`    Status: ${booking.status}`);
                    log(`    Contact: ${booking.contact_phone}`);
                });
            } else {
                log('‚ùå No local bookings found');
            }
        }
        
        function clearBookings() {
            localStorage.removeItem('weddingbazaar_local_bookings');
            log('üßπ Cleared all local bookings');
        }
        
        // Initial check
        checkBookings();
    </script>
</body>
</html>
