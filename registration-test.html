<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #e11d48;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #be185d;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #dcfce7;
            border: 1px solid #16a34a;
            color: #166534;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #dc2626;
            color: #991b1b;
        }
        .info {
            background: #dbeafe;
            border: 1px solid #2563eb;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <h1>üéâ Wedding Bazaar Registration Test Suite</h1>
    
    <div class="test-section">
        <h2>üß™ API Registration Tests</h2>
        <p>Test the registration endpoints directly</p>
        
        <button class="test-button" onclick="testCoupleRegistration()">Test Couple Registration</button>
        <button class="test-button" onclick="testVendorRegistration()">Test Vendor Registration</button>
        <button class="test-button" onclick="testValidation()">Test Validation Errors</button>
        
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>üñ•Ô∏è Frontend Form Tests</h2>
        <p>Test the actual registration modal</p>
        
        <button class="test-button" onclick="openRegistrationModal()">Open Registration Modal</button>
        <button class="test-button" onclick="fillCoupleForm()">Auto-Fill Couple Form</button>
        <button class="test-button" onclick="fillVendorForm()">Auto-Fill Vendor Form</button>
        
        <div id="frontend-results"></div>
    </div>

    <div class="test-section">
        <h2>üìä Test Results Summary</h2>
        <div id="summary"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        const FRONTEND_BASE = 'http://localhost:5173';
        
        let testResults = [];

        function log(message, type = 'info') {
            console.log(message);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            return div;
        }

        async function testCoupleRegistration() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '';
            
            try {
                const timestamp = Date.now();
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: `couple${timestamp}@test.com`,
                        password: 'testpass123',
                        firstName: 'John',
                        lastName: 'Smith',
                        role: 'couple',
                        phone: '+63 912 345 6789'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.appendChild(log('‚úÖ Couple registration successful!', 'success'));
                    resultsDiv.appendChild(log(`User ID: ${data.user.id}`, 'info'));
                    resultsDiv.appendChild(log(`Email: ${data.user.email}`, 'info'));
                    testResults.push({ test: 'Couple Registration', status: 'PASS' });
                } else {
                    const error = await response.json();
                    resultsDiv.appendChild(log(`‚ùå Registration failed: ${error.message}`, 'error'));
                    testResults.push({ test: 'Couple Registration', status: 'FAIL', error: error.message });
                }
            } catch (error) {
                resultsDiv.appendChild(log(`‚ùå Network error: ${error.message}`, 'error'));
                testResults.push({ test: 'Couple Registration', status: 'FAIL', error: error.message });
            }
            
            updateSummary();
        }

        async function testVendorRegistration() {
            const resultsDiv = document.getElementById('api-results');
            
            try {
                const timestamp = Date.now();
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: `vendor${timestamp}@test.com`,
                        password: 'testpass123',
                        firstName: 'Maria',
                        lastName: 'Garcia',
                        role: 'vendor',
                        phone: '+63 912 345 6789',
                        business_name: 'Garcia Photography',
                        business_type: 'Photography',
                        location: 'Makati, Metro Manila'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.appendChild(log('‚úÖ Vendor registration successful!', 'success'));
                    resultsDiv.appendChild(log(`Business: ${data.user.business_name || 'N/A'}`, 'info'));
                    resultsDiv.appendChild(log(`User ID: ${data.user.id}`, 'info'));
                    testResults.push({ test: 'Vendor Registration', status: 'PASS' });
                } else {
                    const error = await response.json();
                    resultsDiv.appendChild(log(`‚ùå Vendor registration failed: ${error.message}`, 'error'));
                    testResults.push({ test: 'Vendor Registration', status: 'FAIL', error: error.message });
                }
            } catch (error) {
                resultsDiv.appendChild(log(`‚ùå Network error: ${error.message}`, 'error'));
                testResults.push({ test: 'Vendor Registration', status: 'FAIL', error: error.message });
            }
            
            updateSummary();
        }

        async function testValidation() {
            const resultsDiv = document.getElementById('api-results');
            
            try {
                // Test missing required fields
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'incomplete@test.com'
                        // Missing required fields
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    resultsDiv.appendChild(log('‚úÖ Validation working correctly!', 'success'));
                    resultsDiv.appendChild(log(`Error: ${error.message}`, 'info'));
                    testResults.push({ test: 'Validation', status: 'PASS' });
                } else {
                    resultsDiv.appendChild(log('‚ùå Validation should have failed!', 'error'));
                    testResults.push({ test: 'Validation', status: 'FAIL' });
                }
            } catch (error) {
                resultsDiv.appendChild(log(`‚ùå Network error: ${error.message}`, 'error'));
                testResults.push({ test: 'Validation', status: 'FAIL', error: error.message });
            }
            
            updateSummary();
        }

        function openRegistrationModal() {
            const resultsDiv = document.getElementById('frontend-results');
            resultsDiv.innerHTML = '';
            
            // Open the main app in a new window/tab
            const newWindow = window.open(FRONTEND_BASE, '_blank');
            
            resultsDiv.appendChild(log('‚úÖ Opening Wedding Bazaar homepage...', 'success'));
            resultsDiv.appendChild(log('üëÜ Click "Sign Up" or "Register" to test the registration form!', 'info'));
            resultsDiv.appendChild(log('üîç Check the browser console for any errors', 'info'));
        }

        function fillCoupleForm() {
            const resultsDiv = document.getElementById('frontend-results');
            resultsDiv.appendChild(log('üìù Instructions for Couple Registration:', 'info'));
            resultsDiv.appendChild(log('1. Select "Planning My Wedding" option', 'info'));
            resultsDiv.appendChild(log('2. Fill: First Name: "Test", Last Name: "Couple"', 'info'));
            resultsDiv.appendChild(log(`3. Email: "testcouple${Date.now()}@example.com"`, 'info'));
            resultsDiv.appendChild(log('4. Phone: "+63 912 345 6789"', 'info'));
            resultsDiv.appendChild(log('5. Password: "testpass123"', 'info'));
            resultsDiv.appendChild(log('6. Check "I agree to terms"', 'info'));
            resultsDiv.appendChild(log('7. Click "Create My Account"', 'info'));
        }

        function fillVendorForm() {
            const resultsDiv = document.getElementById('frontend-results');
            resultsDiv.appendChild(log('üìù Instructions for Vendor Registration:', 'info'));
            resultsDiv.appendChild(log('1. Select "Wedding Vendor" option', 'info'));
            resultsDiv.appendChild(log('2. Fill: First Name: "Test", Last Name: "Vendor"', 'info'));
            resultsDiv.appendChild(log(`3. Email: "testvendor${Date.now()}@example.com"`, 'info'));
            resultsDiv.appendChild(log('4. Phone: "+63 912 345 6789"', 'info'));
            resultsDiv.appendChild(log('5. Password: "testpass123"', 'info'));
            resultsDiv.appendChild(log('6. Business Name: "Test Photography"', 'info'));
            resultsDiv.appendChild(log('7. Category: "Photography"', 'info'));
            resultsDiv.appendChild(log('8. Location: Search and select a location', 'info'));
            resultsDiv.appendChild(log('9. Check "I agree to terms"', 'info'));
            resultsDiv.appendChild(log('10. Click "Create My Account"', 'info'));
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            const passed = testResults.filter(r => r.status === 'PASS').length;
            const failed = testResults.filter(r => r.status === 'FAIL').length;
            
            summaryDiv.innerHTML = `
                <div class="result info">
                    <strong>Tests Run:</strong> ${testResults.length} | 
                    <strong>Passed:</strong> ${passed} | 
                    <strong>Failed:</strong> ${failed}
                </div>
            `;
            
            if (failed > 0) {
                const failedTests = testResults.filter(r => r.status === 'FAIL');
                failedTests.forEach(test => {
                    summaryDiv.appendChild(log(`‚ùå ${test.test}: ${test.error || 'Unknown error'}`, 'error'));
                });
            }
        }

        // Auto-run basic health check on page load
        window.onload = async function() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('summary').appendChild(
                        log(`‚úÖ Backend server is running (${data.environment})`, 'success')
                    );
                } else {
                    document.getElementById('summary').appendChild(
                        log('‚ùå Backend server is not responding', 'error')
                    );
                }
            } catch (error) {
                document.getElementById('summary').appendChild(
                    log(`‚ùå Cannot connect to backend: ${error.message}`, 'error')
                );
            }
        };
    </script>
</body>
</html>
