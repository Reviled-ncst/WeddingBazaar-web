╔═══════════════════════════════════════════════════════════════════════╗
║  🎯 BOOKING EMAIL NOTIFICATION - ULTIMATE QUICK TEST GUIDE           ║
╚═══════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────┐
│ 📋 WHAT YOU NEED TO KNOW                                            │
└─────────────────────────────────────────────────────────────────────┘

PROBLEM:
  • Booking requests don't show success modal
  • Vendors don't receive email notifications

ROOT CAUSE:
  • Booking API calls are NOT reaching the backend
  • Only profile/conversation requests appear in Render logs

SOLUTION:
  • Test if backend works (bypass frontend)
  • If backend works → Fix frontend
  • If backend fails → Fix backend/email

┌─────────────────────────────────────────────────────────────────────┐
│ ⚡ 2-MINUTE QUICK TEST - DO THIS FIRST                              │
└─────────────────────────────────────────────────────────────────────┘

STEP 1: Open Your Site
  → https://weddingbazaarph.web.app

STEP 2: Open Browser Console
  → Press F12
  → Click "Console" tab

STEP 3: Copy This EXACT Command
  ┌────────────────────────────────────────────────────────────────┐
  │ fetch('https://weddingbazaar-web.onrender.com/api/bookings/request', { │
  │   method: 'POST',                                               │
  │   headers: { 'Content-Type': 'application/json' },              │
  │   body: JSON.stringify({                                        │
  │     coupleId: '1', vendorId: '1', serviceId: '1',               │
  │     serviceName: 'TEST', serviceType: 'photography',            │
  │     eventDate: '2025-12-31', eventLocation: 'Manila',           │
  │     contactPerson: 'Test', contactPhone: '+639171234567',       │
  │     contactEmail: 'test@example.com', vendorName: 'Test',       │
  │     coupleName: 'Test'                                          │
  │   })                                                            │
  │ }).then(r => r.json()).then(console.log);                       │
  └────────────────────────────────────────────────────────────────┘

STEP 4: Press Enter

STEP 5: Check Results in Console
  ✅ SUCCESS LOOKS LIKE:
    {
      success: true,
      booking: {
        id: "some-uuid",
        couple_id: "1",
        vendor_id: "1",
        ...
      }
    }

  ❌ FAILURE LOOKS LIKE:
    Error: Failed to fetch
    OR
    { success: false, error: "..." }

┌─────────────────────────────────────────────────────────────────────┐
│ 🔍 WHAT TO DO AFTER THE TEST                                        │
└─────────────────────────────────────────────────────────────────────┘

IF TEST SUCCEEDED (success: true):
  ✅ Backend booking creation works!
  ✅ Email notification should have been sent!
  
  → NOW CHECK RENDER LOGS:
    1. Go to: https://dashboard.render.com
    2. Select your backend service
    3. Click "Logs" tab
    4. Search for: "Creating booking request"
    5. Search for: "Sending new booking notification"
  
  → LOOK FOR THESE MESSAGES:
    "📝 Creating booking request"
    "✅ Booking request created with ID: [uuid]"
    "📧 Sending new booking notification to vendor: [email]"
    "✅ Email sent successfully" (from emailService)
  
  → CHECK VENDOR EMAIL INBOX:
    • Vendor with ID "1" should receive email
    • Subject: "New Wedding Booking Request"
    • From: Your Gmail account

  IF EMAIL WAS SENT:
    🎉 PROBLEM SOLVED! Backend works!
    → Problem is in FRONTEND (booking modal not calling API)
    → Next: Debug BookingRequestModal.tsx

  IF EMAIL NOT SENT:
    → Check vendor has email in database
    → Check Render logs for email errors
    → Run: node backend-deploy/test-email-manually.cjs

─────────────────────────────────────────────────────────────────────

IF TEST FAILED (error):
  ❌ Backend is not working properly
  
  → CHECK ERROR MESSAGE:
    "Failed to fetch" → Network/CORS issue
    "404" → Route not found
    "500" → Server error
  
  → CHECK RENDER STATUS:
    1. Go to: https://dashboard.render.com
    2. Check if service is "Live"
    3. Check recent deployments
    4. Check logs for errors
  
  → TEST BACKEND HEALTH:
    Run this in console:
    fetch('https://weddingbazaar-web.onrender.com/api/health')
      .then(r => r.json()).then(console.log);
    
    Should return: {status: "ok", ...}

┌─────────────────────────────────────────────────────────────────────┐
│ 🧪 ADDITIONAL TESTS (If Quick Test Fails)                          │
└─────────────────────────────────────────────────────────────────────┘

TEST 1: Backend Health
  fetch('https://weddingbazaar-web.onrender.com/api/health')
    .then(r => r.json()).then(console.log);

TEST 2: Email Configuration
  fetch('https://weddingbazaar-web.onrender.com/api/bookings/test-email-config')
    .then(r => r.json()).then(console.log);

TEST 3: Check Vendor Email in Database
  Run in Neon SQL console:
  SELECT vp.id, vp.business_name, u.email
  FROM vendor_profiles vp
  LEFT JOIN users u ON vp.user_id = u.id
  WHERE vp.id = '1';

┌─────────────────────────────────────────────────────────────────────┐
│ 📊 RENDER LOGS - WHAT TO LOOK FOR                                  │
└─────────────────────────────────────────────────────────────────────┘

SUCCESSFUL BOOKING + EMAIL:
  ┌──────────────────────────────────────────────────────────────┐
  │ 📝 Creating booking request: {...}                           │
  │ 💾 Inserting booking with data: {...}                        │
  │ ✅ Booking request created with ID: abc-123-def              │
  │ 📧 Sending new booking notification to vendor: vendor@email  │
  │ ✅ Email sent successfully to vendor@email                   │
  └──────────────────────────────────────────────────────────────┘

BOOKING SUCCESS BUT NO EMAIL:
  ┌──────────────────────────────────────────────────────────────┐
  │ 📝 Creating booking request: {...}                           │
  │ ✅ Booking request created with ID: abc-123-def              │
  │ ⚠️ Vendor email not found, skipping notification            │
  └──────────────────────────────────────────────────────────────┘
  → Vendor doesn't have email in database

BOOKING SUCCESS BUT EMAIL ERROR:
  ┌──────────────────────────────────────────────────────────────┐
  │ 📝 Creating booking request: {...}                           │
  │ ✅ Booking request created with ID: abc-123-def              │
  │ 📧 Sending new booking notification to vendor: vendor@email  │
  │ ❌ Failed to send vendor notification email: [error]        │
  └──────────────────────────────────────────────────────────────┘
  → Email service configuration issue

NO LOGS AT ALL:
  → Request not reaching backend
  → Check network tab in browser
  → Check frontend is calling correct API URL

┌─────────────────────────────────────────────────────────────────────┐
│ 🎯 DECISION FLOWCHART                                               │
└─────────────────────────────────────────────────────────────────────┘

                    RUN QUICK TEST
                         │
         ┌───────────────┼───────────────┐
         │                               │
      SUCCESS                         FAILURE
         │                               │
    Check Render Logs              Check Backend
         │                               │
  ┌──────┴──────┐                   Is it down?
  │             │                        │
Email      No Email                 ┌────┴────┐
Sent       Logs                    Yes       No
  │             │                   │         │
FIXED!    Check Vendor          Restart   Check
          Email in DB           Service    CORS
              │                             │
         Has Email?                    Check API
              │                          URL
         ┌────┴────┐
        Yes       No
         │         │
    Email Conf  Add Email
      Issue    to Vendor

┌─────────────────────────────────────────────────────────────────────┐
│ ✅ SUCCESS CHECKLIST                                                │
└─────────────────────────────────────────────────────────────────────┘

Booking Flow Complete When:
  □ Fetch test returns success: true
  □ Render logs show "Creating booking request"
  □ Render logs show "Booking request created"
  □ Render logs show "Sending new booking notification"
  □ Render logs show "Email sent successfully" (or no error)
  □ Vendor email inbox has new email
  □ Real booking from website UI also works

Email Notification Complete When:
  □ Vendor receives email within 1-2 minutes
  □ Email subject: "New Wedding Booking Request"
  □ Email contains booking details
  □ No errors in Render logs

┌─────────────────────────────────────────────────────────────────────┐
│ 🚀 ACTION ITEMS - DO IN THIS ORDER                                 │
└─────────────────────────────────────────────────────────────────────┘

1. □ Run quick test in browser console
2. □ Check console output (success or error?)
3. □ Check Render logs immediately
4. □ Check vendor email inbox
5. □ Share results in chat:
     - Console output screenshot
     - Render logs screenshot
     - Email received? (Yes/No)

┌─────────────────────────────────────────────────────────────────────┐
│ 📞 NEED HELP?                                                       │
└─────────────────────────────────────────────────────────────────────┘

Share these in chat:
  1. Console output from quick test
  2. Render logs (search "booking" and "email")
  3. Any error messages
  4. Vendor email status (received or not)

Files to reference:
  • BOOKING_EMAIL_DIAGNOSTIC_COMPLETE.md - Full guide
  • RUN_IN_BROWSER_CONSOLE.js - Automated test script
  • TEST_BOOKING_FLOW_COMPLETE.md - Detailed tests

┌─────────────────────────────────────────────────────────────────────┐
│ 🎯 TL;DR - JUST DO THIS                                            │
└─────────────────────────────────────────────────────────────────────┘

1. Open https://weddingbazaarph.web.app
2. Press F12 → Console
3. Paste this:

fetch('https://weddingbazaar-web.onrender.com/api/bookings/request', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    coupleId: '1', vendorId: '1', serviceId: '1', serviceName: 'TEST',
    serviceType: 'photography', eventDate: '2025-12-31',
    eventLocation: 'Manila', contactPerson: 'Test',
    contactPhone: '+639171234567', contactEmail: 'test@example.com',
    vendorName: 'Test', coupleName: 'Test'
  })
}).then(r => r.json()).then(console.log);

4. Press Enter
5. Check Render logs for "Sending new booking notification"
6. Share results!

╔═══════════════════════════════════════════════════════════════════════╗
║  ✅ READY TO TEST? FOLLOW THE STEPS ABOVE NOW!                       ║
╚═══════════════════════════════════════════════════════════════════════╝
