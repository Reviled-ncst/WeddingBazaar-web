<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages Scrolling Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .messages-container {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin: 20px 0;
            scroll-behavior: smooth;
            overscroll-behavior: contain;
        }
        .message {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 20px;
            border-left: 4px solid #4CAF50;
        }
        .message.user {
            background: rgba(76, 175, 80, 0.3);
            margin-left: 20%;
            border-left-color: #81C784;
        }
        .load-more {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px auto;
            display: block;
        }
        .load-more:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        /* Custom scrollbar */
        .messages-container::-webkit-scrollbar {
            width: 6px;
        }
        .messages-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 6px;
        }
        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Messages UI Scrolling Test</h1>
        <p>This test simulates the message limiting and scrolling behavior.</p>
        
        <div>
            <p><strong>Current Messages:</strong> <span id="message-count">20</span></p>
            <p><strong>Visible Messages:</strong> <span id="visible-count">20</span></p>
        </div>

        <div class="messages-container" id="messages-container">
            <!-- Messages will be generated here -->
        </div>

        <div>
            <button onclick="addMessages()">Add 10 Messages</button>
            <button onclick="resetMessages()">Reset</button>
            <button onclick="scrollToBottom()">Scroll to Bottom</button>
        </div>
    </div>

    <script>
        let totalMessages = 20;
        let visibleMessageLimit = 50;
        let messages = [];

        // Initialize with sample messages
        function initializeMessages() {
            messages = [];
            for (let i = 1; i <= totalMessages; i++) {
                messages.push({
                    id: i,
                    content: `Message ${i} - This is a sample message to test the scrolling behavior. Lorem ipsum dolor sit amet, consectetur adipiscing elit.`,
                    isUser: i % 3 === 0,
                    timestamp: new Date(Date.now() - (totalMessages - i) * 60000).toLocaleTimeString()
                });
            }
            renderMessages();
        }

        function renderMessages() {
            const container = document.getElementById('messages-container');
            const visibleMessages = messages.slice(-visibleMessageLimit);
            
            let html = '';
            
            // Show "Load More" if there are more messages than visible
            if (messages.length > visibleMessageLimit) {
                const hiddenCount = messages.length - visibleMessageLimit;
                html += `<button class="load-more" onclick="loadMoreMessages()">
                    Load Previous Messages (${hiddenCount} more)
                </button>`;
            }

            // Render visible messages
            visibleMessages.forEach((message, index) => {
                html += `
                    <div class="message ${message.isUser ? 'user' : ''}">
                        <strong>${message.isUser ? 'You' : 'Vendor'}:</strong> ${message.content}
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 5px;">${message.timestamp}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
            
            // Update counters
            document.getElementById('message-count').textContent = messages.length;
            document.getElementById('visible-count').textContent = visibleMessages.length;
            
            // Auto-scroll to bottom for new messages
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        function addMessages() {
            const startNum = totalMessages + 1;
            for (let i = startNum; i < startNum + 10; i++) {
                messages.push({
                    id: i,
                    content: `New message ${i} - Just added! This simulates receiving new messages in the conversation.`,
                    isUser: i % 2 === 0,
                    timestamp: new Date().toLocaleTimeString()
                });
            }
            totalMessages += 10;
            renderMessages();
        }

        function loadMoreMessages() {
            visibleMessageLimit += 30;
            renderMessages();
            
            // Don't auto-scroll when loading more (user is browsing history)
            const container = document.getElementById('messages-container');
            container.scrollTop = 100; // Keep some scroll position
        }

        function resetMessages() {
            totalMessages = 20;
            visibleMessageLimit = 50;
            initializeMessages();
        }

        function scrollToBottom() {
            const container = document.getElementById('messages-container');
            container.scrollTop = container.scrollHeight;
        }

        // Initialize on page load
        initializeMessages();

        // Demo: Add a new message every 5 seconds
        setInterval(() => {
            if (Math.random() > 0.7) { // 30% chance
                addMessages();
            }
        }, 5000);
    </script>
</body>
</html>
