<!DOCTYPE html>
<html>
<head>
    <title>Vendor ID Resolution Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-case { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç Vendor ID Resolution Test</h1>
    <p>This page tests the vendor ID mapping logic with different user scenarios.</p>
    
    <div id="test-results"></div>
    
    <script>
    // Vendor ID mapping logic (copied from utility)
    const VENDOR_MAPPINGS = [
      { userId: '1', vendorId: '2-2025-001', businessName: 'Test Business' },
      { userId: '2', vendorId: '2-2025-003', businessName: 'Beltran Sound Systems' },
      { userId: '3', vendorId: '2-2025-002', businessName: 'Unknown Vendor 2' },
      { userId: '4', vendorId: '2-2025-004', businessName: 'Perfect Weddings Co.' },
      { userId: '5', vendorId: '2-2025-005', businessName: 'Unknown Vendor 5' },
    ];
    
    const EMAIL_MAPPINGS = {
      'vendor1@test.com': '2-2025-001',
      'vendor2@test.com': '2-2025-003', 
      'vendor3@test.com': '2-2025-002',
      'vendor4@test.com': '2-2025-004',
      'vendor5@test.com': '2-2025-005',
    };
    
    function getVendorIdForUser(user) {
      if (!user) return null;
      
      // Strategy 1: Check if user.id is already a vendor ID format
      if (user.id && /^\d+-\d{4}-\d{3}$/.test(user.id)) {
        return user.id;
      }
      
      // Strategy 2: Check if user has explicit vendorId field
      if (user.vendorId) {
        return user.vendorId;
      }
      
      // Strategy 3: Map user ID to vendor ID
      if (user.id) {
        const mapping = VENDOR_MAPPINGS.find(m => m.userId === user.id);
        if (mapping) return mapping.vendorId;
      }
      
      // Strategy 4: Map email to vendor ID
      if (user.email) {
        const mappedId = EMAIL_MAPPINGS[user.email];
        if (mappedId) return mappedId;
      }
      
      return null;
    }
    
    // Test cases
    const testCases = [
      {
        name: 'User with numeric ID',
        user: { id: '2', role: 'vendor', email: 'test@example.com' },
        expected: '2-2025-003'
      },
      {
        name: 'User with vendor ID format',
        user: { id: '2-2025-001', role: 'vendor' },
        expected: '2-2025-001'
      },
      {
        name: 'User with explicit vendorId',
        user: { id: '123', vendorId: '2-2025-004', role: 'vendor' },
        expected: '2-2025-004'
      },
      {
        name: 'User with mapped email',
        user: { id: '999', email: 'vendor1@test.com', role: 'vendor' },
        expected: '2-2025-001'
      },
      {
        name: 'Non-vendor user',
        user: { id: '1', role: 'couple' },
        expected: null
      },
      {
        name: 'Unknown user',
        user: { id: '999', role: 'vendor' },
        expected: null
      }
    ];
    
    function runTests() {
      const resultsDiv = document.getElementById('test-results');
      let html = '';
      
      testCases.forEach((testCase, index) => {
        const result = getVendorIdForUser(testCase.user);
        const passed = result === testCase.expected;
        const className = passed ? 'success' : 'error';
        
        html += `
          <div class="test-case ${className}">
            <h3>Test ${index + 1}: ${testCase.name}</h3>
            <p><strong>Status:</strong> ${passed ? '‚úÖ PASS' : '‚ùå FAIL'}</p>
            <p><strong>Expected:</strong> ${testCase.expected}</p>
            <p><strong>Got:</strong> ${result}</p>
            <pre><strong>Input:</strong> ${JSON.stringify(testCase.user, null, 2)}</pre>
          </div>
        `;
      });
      
      resultsDiv.innerHTML = html;
    }
    
    // Run tests on page load
    runTests();
    </script>
</body>
</html>