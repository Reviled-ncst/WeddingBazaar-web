// Simple Frontend Payment Test
// Tests if frontend can connect to payment API

async function testFrontendPaymentAPI() {
  console.log('üåê Testing Frontend Payment API Connection...\n');

  const API_BASE = 'http://localhost:3001';
  
  const tests = [
    {
      name: 'Create PayMongo Payment (like PayMongoPaymentModal would)',
      url: `${API_BASE}/api/payment/paymongo/create`,
      method: 'POST',
      data: {
        amount: 15000,
        currency: 'PHP',
        description: 'Wedding service downpayment',
        paymentMethod: 'gcash',
        bookingId: 'frontend-test-booking'
      }
    },
    {
      name: 'Check Payment Status (real-time polling)',
      url: `${API_BASE}/api/payment/paymongo/status/frontend-test-payment`,
      method: 'GET'
    },
    {
      name: 'Email Receipt (after payment success)',
      url: `${API_BASE}/api/payment/receipt/receipt-123/email`,
      method: 'POST',
      data: {
        email: 'couple@example.com'
      }
    },
    {
      name: 'Process Refund (if payment fails)',
      url: `${API_BASE}/api/payment/refund/frontend-test-payment`,
      method: 'POST',
      data: {
        amount: 3000,
        reason: 'Payment processing error'
      }
    }
  ];

  for (const test of tests) {
    try {
      console.log(`üîç ${test.name}...`);
      
      const options = {
        method: test.method,
        headers: {
          'Content-Type': 'application/json'
        }
      };

      if (test.data) {
        options.body = JSON.stringify(test.data);
      }

      const response = await fetch(test.url, options);
      
      if (response.ok) {
        const data = await response.json();
        console.log(`‚úÖ SUCCESS: ${test.name}`);
        console.log(`   Response: ${JSON.stringify(data, null, 2).substring(0, 150)}...`);
      } else {
        console.log(`‚ùå FAILED: ${test.name} - HTTP ${response.status}`);
      }
      
    } catch (error) {
      console.log(`‚ùå ERROR: ${test.name} - ${error.message}`);
    }
    
    console.log(''); // Empty line
  }

  console.log('üéØ Frontend payment API connection test complete!');
  console.log('   The PayMongoPaymentModal should now be able to:');
  console.log('   ‚úÖ Create payments via /api/payment/paymongo/create');
  console.log('   ‚úÖ Poll payment status via /api/payment/paymongo/status/:id');
  console.log('   ‚úÖ Send receipts via /api/payment/receipt/:id/email');
  console.log('   ‚úÖ Process refunds via /api/payment/refund/:id');
}

// Run the test
testFrontendPaymentAPI();
